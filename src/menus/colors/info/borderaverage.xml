<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sect2 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.docbook.org/xml/4.5/docbookx.dtd">
<!-- section history:
  2008-05-23 j.h: tried to give more intelligible explanations for bucket size
  2007-12-22 alex falappa: moved here from color filters and translated missing parts
  2007-10-22 ude: moved here from filters/color/borderaverage.xml ('en','de')
  2007-07-03 Added Spanish translation by AntI
  2007-06-21 alex falappa: translated new bucket size related stuff in italian
  2007-05-12 ude: fixed bucket size related stuff incl. examples
  2007-04-15 ude: moved examples to <sect3>
  2007-04-03 KoSt: added 'no'
  2006-12-20 de adapted description by ude
  2006-11-01 Changes in the description of the action and Number of colors by j.h
  2005-12-07 replaced <simplesect> by <sect3> by lexa
  2005-08-30 de replaced informalfigure by axel.wernicke
  2005-08-24 de added by axel.wernicke
-->
<!--TODO: es ru: update/review -->
<sect2 id="plug-in-borderaverage">
  <sect2info role="cvs">
    <revhistory>
      <revision>
        <revnumber>$Revision$</revnumber>
        <date>2008-05-23</date>
        <authorinitials>j.h</authorinitials>
      </revision>
      
      
      
      
      
    </revhistory>
  </sect2info>

  <title>
    <phrase>Border Average</phrase>
    
    
    
    
    
    
    
    
  </title>

  <indexterm significance="normal">
    <primary>Colors</primary>
    <secondary>Border Average</secondary>
  </indexterm>
  <indexterm significance="normal"><primary>Border Average</primary></indexterm>

  <!--TODO es ru: check/change indexterms-->
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  <sect3>
    <title>
      <phrase>Overview</phrase>
      
      
      
      
      
      
      
      
    </title>

    <figure float="0">
      <title>
        <phrase>
          Example for the <quote>Border Average</quote> filter
        </phrase>
        
        
        
        
        
        
        
      </title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../images/filters/examples/taj_orig.png" format="PNG"/>
        </imageobject>
        <caption>
          <para>Original image</para>
          
          
          
          
          
        </caption>
      </mediaobject>

      <mediaobject>
        <imageobject>
          <imagedata format="PNG" fileref="../images/filters/examples/color-taj-borderaverage.png"/>
        </imageobject>
        <caption>
          <para>Filter <quote>Border Average</quote> applied</para>
          
          
          
          
          
        </caption>
      </mediaobject>
    </figure>

    <para><!--changed 08-05-23-->
      This plug-in calculates the most often used color in a specified border
      of the the active layer or selection. It can gather similar colors
      together so that they become predominant. The calculated color becomes
      the foreground color in the Toolbox. This filter is interesting when
      you have to find a Web page color background that differs as little as
      possible from your image border. The action of this filter is not
      registered in Undo History and can't be deleted with Ctrl+Z : it
      doesn't modify the image.
    </para>
    
    
    
    
    

    <!--TODO es ru: change menuentries (and move to next sect3)-->
    
    

    

    

    

    
    
  </sect3>


  <sect3>
    <title>
      <phrase>Activate the filter</phrase>
      
      
      
      
      
      
      
      
      
    </title>
    <para>
      This filter is found in the image window menu under
      <menuchoice moreinfo="none">
        <guimenu moreinfo="none">Colors</guimenu>
        <guimenu moreinfo="none">Info</guimenu>
        <guimenuitem moreinfo="none"><accel>B</accel>order Average</guimenuitem>
      </menuchoice>.
    </para>
    
    

    
    
    
    
  </sect3>


  <sect3>
    <title>
      <phrase>Options</phrase>
      
      
      
      
      
      
      
      
    </title>

    <figure float="0">
      <title>
        <phrase>
          Options of the <quote>Border Average Filter</quote>
        </phrase>
        
        
        
        
        
        
        
      </title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../images/filters/filters-color-borderaverage.png" format="PNG"/>
        </imageobject>
        
        
        
        
        
        
      </mediaobject>
    </figure>

    <variablelist>
      <varlistentry>
        <term>Border Size</term>
        
        
        
        
        
        
        
        

        <listitem>
          <para>
            You can set there the border <guilabel moreinfo="none">Thickness</guilabel> in
            pixels.
          </para>
          
          
          
          
          
          
          
          
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Number of Colors</term>
        
        
        
        
        
        
        
        

        <listitem>
          <!--FIXME cs: description was wrong, has been fixed-->
          <para><!--changed 2007-05-12-->
            The <guilabel moreinfo="none">Bucket Size</guilabel> lets you control the number
            of colors considered as similar and counted with the same
            <quote>bucket</quote>. A low bucket size value (i.e. a high bucket
            number) gives you better precision in the calculation of the
            average color. Note that better precision does not necessarily
            mean better results (see example below).
          </para>
          
          
          
          
          
          
          
          
        </listitem>
      </varlistentry>
    </variablelist>
  </sect3>

  <sect3>
    <title>
      <phrase>
        Examples illustrating the <quote>Border Average</quote> filter
      </phrase>
      
      
      
      
      
      
      
    </title>

    <figure float="0">
      <title>
        <phrase>Original image</phrase>
        
        
        
        
        
        
        
      </title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../images/filters/examples/borderaverage.png" format="PNG"/>
        </imageobject>

        <caption>
          <!--TODO es;it;lt;ru-->
          <para>
            Original image: colors are pure Red (255;0;0), pure Blue
            (0;0;255), and different but similar kinds of Green
            ( 0;255;0 , 63;240;63 , 48;224;47 , 0;192;38 ).
          </para>
          
          
          
          
          
          
          
        </caption>
      </mediaobject>
    </figure>

    <figure float="0">
      <title>
        <phrase>
          <quote>Number of Colors</quote> is set to 8:
        </phrase>
        
        
        
        
        
        
        
      </title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../images/filters/examples/borderaverage08.png" format="PNG"/>
        </imageobject>

        <caption>
          <para>
            The resulting color is a Red (254,2,2).
          </para>
          
          
          
          
          
          
          
        </caption>
      </mediaobject>
    </figure>

    <para><!--changed 2008-05-23-->
      The bucket size is low. So the bucket number is high. All color shades
      can be stored in different buckets. Here, the bucket containing red is
      the most filled. The resulting color is a nearly pure
      Red (254,2,2) and becomes the foreground color of the Toolbox.
      </para>
    
    
    
    
    
    
    

    <figure float="0">
      <title>
        <phrase>
          <quote>Number of Colors</quote> is set to 64:
        </phrase>
        
        
        
        
        
        
        
      </title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../images/filters/examples/borderaverage64.png" format="PNG"/>
        </imageobject>

        <caption>
          <para>
            The resulting color is Green (32,224,32).
          </para>
          
          
          
          
          
          
          
        </caption>
      </mediaobject>
    </figure>

    <!-- Where comes the green (0-63,192-255,0-63) from and how
    can it be averaged to (32,224,32) if only the two most significant bits are counting?
    Would it be more readable using hexcode?-->
      <!--08-05-23: I took this information from the gimp-plugin registry when
      border average was a plug-in. Now, it is no longer in the registry and
      this information disappeared :-( -->
    <!-- Julien's enhanced explanation is good and readable, but if there are
      still questions, I tried to explain the filter internals;
      see the notes at the bottom of this file - ude, 08-06-06 -->
    <!--TODO es;it;lt;ru-->
    <para><!--changed 2008-06-07-->
      Here the bucket size is high, the number of buckets low. Similar colors
      (here green) are stored in a same bucket. This <quote>green</quote>
      bucket is now the most filled.
      All colors in this bucket have the same values for the two most
      significant bits: (00******;11******;00******). The remaining 6 bits
      may have any values from 0 to 63 for the respective channel. So
      in this bucket, color red channels range from 0 to 63, green channels
      from 192 to 255, blue channels from 0 to 63. The resulting color is
      Green (32,224,32), which, for every channel, is the average between the
      limits of the channel range (63 + 0)/2, (255+192)/2 , (63+0)/2.
    </para>
    <!--FIXME fr: that's wrong! (see below)
    <para lang="en"> <!==added 080525==>
      With this method, if your border has a lot of different colors, then
      channels will even out and the resulting color will be gray.
    </para>-->
    
    
    
    <!--FIXME fr: That's wrong! The number of pixels in the bucket doesn't
        matter, so any bucket may win... -->
    
    
    
    
    
  </sect3>
</sect2><!--
  Ok, it *is* a bit tricky. And the example colors and values are
  definitely not the best choice.

  Let's see what the filter will return in the above example with
  "number of colors" = 64 (cf. source file "common/border-average.c"):

  The filter uses
    bucket size      = 64  (input via dialog)
    bucket exponent  =  6  (2 ** 6 = 64)        :  "noise"
    reverse exponent =  2  (8 - bucket exponent):  significant color bits
    bucket number    = 64  (64 = 4*4*4;  4 = 2 ** reverse exponent)
    Now bucket #12 (binary: 001100; note: 6 Bits, 2**6 = 64) will count
    *any* color with
        red   = 00****** (bit7 = 0, bit6 = 0, bit5, ..., bit0 = 0 or 1),
        green = 11****** (bit7 = 1, bit6 = 1, bit5, ..., bit0 = 0 or 1),
        blue  = 00******.
    Let this bucket contain the max number of pixels, then the filter returns
       R = 0 * 2**6 + 2**5  =  32
       G = 3 * 2**6 + 2**5  = 224  (binary 11 = decimal 3) 
       B = 0 * 2**6 + 2**5  =  32
    32 is the mean value of
      bit7=0, bit6=0, bit5=...=bit0=0 (00000000 = 0) and
      bit7=0, bit6=0, bit5=...=bit0=1 (00111111 = 63).
    So we have 64 (bucket number) distinct colors (buckets) and a 6 bit
    "noise" (bucket size) to each color.
    (Note that generally bucket size != bucket number.)
-->
