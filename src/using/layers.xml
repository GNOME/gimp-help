<?xml version='1.0' encoding="UTF-8" ?>

<sect2 id='gimp-using-layers' xmlns:xi="http://www.w3.org/2001/XInclude">
  <title lang="en">Layers</title>
  <indexterm>
    <primary lang="en">Image</primary>
    <secondary lang="en">Layers</secondary>
  </indexterm>

  <para lang='en'>
    A good way to visualize a Gimp image is as a stack of
    transparencies:  in Gimp terminology, each individual transparency
    is called a <emphasis>layer</emphasis>.  There is no limit, in
    principle, to the number of layers an image can have:  only
    the amount of memory available on the system.  It is not
    uncommon for advanced users to work with images containing dozens
    of layers.
  </para>

  <para lang='en'>
    The organization of layers in an image is shown by the Layers
    dialog, which is the second most important type of dialog window
    in Gimp, after the Main Toolbox.  The appearance of the Layers
    dialog is shown in the adjoining illustration.  How it works is
    described in detail in the <link
    linkend='gimp-layer-dialog'>Layers Dialog</link> section, but we
    will touch on some aspects of it here, in relation to the layer
    properties that they display.
  </para>

  <para lang='en'>
    Each open image has at any time a single <emphasis>active
    drawable</emphasis>.  A "drawable" is a Gimp concept that includes
    layers, but also several other types of things, such as channels,
    layer masks, and the selection mask.  (Basically, a "drawable" is
    anything that can be drawn on with painting tools.)  If a layer is
    currently active, it is shown highlighted in the Layers dialog,
    and its name is shown in the status area of the image window.
    If not, you can activate it by clicking on it.  If none of the
    layers is highlighted, it means the active drawable is something
    other than a layer.      
  </para>

  <para lang='en'>
    In the menubar above an image window, you can find a menu called
    <guimenu>Layer</guimenu>, containing a number of commands that
    affect the active layer of the image.  The same menu can be
    accessed by right-clicking in the Layers dialog.
  </para>

  <para lang='en'>
    Each layer in an image has a number of important attributes:
  </para>

  <variablelist>
  
    <varlistentry>
    <term lang='en'>Name</term>
    <listitem>
      <para lang='en'>
        Every layer has a name.  This is assigned automatically when
        the layer is created, but you can change it.  You can change
        the name of a layer either by double-clicking on it in the
        Layers dialog, or by right-clicking there and then selecting
        the top entry in the menu that appears, <guimenuitem>Edit
        Layer Attributes</guimenuitem>.
      </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>Presence or absence of an alpha channel</term>
    <listitem>
      <para lang='en'>
        As explained in the previous section, an alpha channel encodes
        information about how transparent a layer is at each pixel.
        Not every layer is required to have an alpha channel, though.
        In many cases, the bottom layer of an image (often named
        "Background") lacks any alpha channel:  this means that it is
        completely opaque at every point.  Alphaless layers are
        created when you open an image from a file format that does
        not support transparency, or when you create a new image using 
        <menuchoice>
          <guimenu>File</guimenu>
          <guimenuitem>New</guimenuitem>
        </menuchoice>, or when you flatten an image into a single
        layer. 
      </para>
      <para lang='en'>
        Every layer other than the bottom layer of an image must have an
        alpha channel. For the bottom layer, it is optional.  Many
        operations cannot be performed on layers that lack an alpha
        channel.  Moving the layer to a different position in the
        layer stack is one obvious example (since only bottom layers
        are allowed not to have an alpha channel), but any operation
        involving transparency would also be included.   You can add
        an alpha channel to a layer that lacks one using the menu
        command 
        <menuchoice>
          <guimenu>Layer</guimenu>
          <guisubmenu>Transparency</guisubmenu>
          <guimenuitem>Add Alpha Channel</guimenuitem>
        </menuchoice>, or by right-clicking in the Layers dialog and
          selecting <guimenuitem>Add Alpha Channel</guimenuitem> from
          the popup menu that appears.  To remove an alpha channel,
          activate the bottom layer by clicking on it in the Layers
          dialog, and then select
        <menuchoice>
          <guimenu>Layer</guimenu>
          <guisubmenu>Transparency</guisubmenu>
          <guimenuitem>Semi-Flatten</guimenuitem>
        </menuchoice>.
       </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>Layer type</term>
    <listitem>
      <para lang='en'>
        The layer type is determined by the image type (see previous
        section) and the presence or absence of an alpha channel.
        These are the possible layer types:
      </para>
      <itemizedlist>
        <listitem>
          <para lang='en'>
            RGB
          </para>
        </listitem>
        <listitem>
          <para lang='en'>
            RGBA
          </para>
        </listitem>
        <listitem>
          <para lang='en'>
            Gray
          </para>
        </listitem>
        <listitem>
          <para lang='en'>
            GrayA
          </para>
        </listitem>
        <listitem>
          <para lang='en'>
            Indexed
          </para>
        </listitem>
        <listitem>
          <para lang='en'>
            IndexedA
          </para>
        </listitem>
      </itemizedlist>
      <para lang='en'>
        The main reason this matters is that most filters (in the
        <guimenu>Filters</guimenu> menu) only accept a subset of layer
        types, and appear grayed out in the menu if the active layer
        does not have an acceptable type.  Often you can rectify this
        either by changing the mode of the image or by adding or
        removing an alpha channel.
      </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>Visibility</term>
    <listitem>
      <para lang='en'>
        It is possible to temporarily remove a layer from an image,
        without destroying it, by clicking on the "open eye" symbol in
        the Layers dialog.  This is called "toggling the visibility"
        of the layer.  Most operations on an image treat toggled-off
        layers as if they did not exist.  When you work with images
        containing many layers, with varying opacity, you often can
        get a better picture of the contents of the layer you want to
        work on by hiding some of the other layers.  
      </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>Linkage to other layers</term>
    <listitem>
      <para lang='en'>
        
      </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>Dimensions</term>
    <listitem>
      <para lang='en'>
        In Gimp, the boundaries of a layer do not necessarily match
        the bondaries of the image that contains it.  When you create
        text, for example, each text item goes into its own separate
        layer, and the layer is precisely sized to contain the text
        and nothing more.  Also, when you create a new layer using
        cut-and-paste, the new layer is sized just large enough to
        contain the pasted item.  In the image window, the boundaries
        of the currently active layer are shown outlined with a
        black-and-yellow dashed line.
      </para>
      <para lang='en'>
        The main reason why this matters is that you cannot do
        anything to a layer outside of its boundaries:  you can't act
        on what doesn't exist.  If this causes you problems, you can
        alter the dimensions of the layer using any of several
        commands that you can find near the bottom of the
        <guimenu>Layer</guimenu> menu.
      </para>
      <note lang='en'>
        The amount of memory that a layer consumes is determined by
        its dimensions, not its contents.  So, if you are working with
        large images or images that contain many layers, it might pay
        off to trim layers to the minimum possible size.
      </note>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>Opacity</term>
    <listitem>
      <para lang='en'>
        The oacity of a layer determines the extent to which it lets
        colors from layers beneath it in the stack show through.
        Opacity ranges from 0 to 100, with 0 meaning complete
        transparency, and 100 meaning complete opacity.  
      </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>Mode</term>
    <listitem>
      <para lang='en'>
        The Mode of a layer determines how colors from the layer are
        combined with colors from the underlying layers to produce a
        visible result.  This is a sufficiently complex, and
        sufficiently important, concept to deserve a section of its
        own, which follows.
      </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>Layer mask</term>
    <listitem>
      <para lang='en'>
        In addition to the alpha channel, there is another way to
        control the transparency of a layer:  by adding a
        <emphasis>layer mask</emphasis>, which is an extra grayscale
        drawable associated with the layer.  A layer does not have a
        layer mask by default:  it must be added specifically.  Layer
        masks, and how to work with them, are described much more
        extensively in a later  section of this chapter devoted to
        them. 
      </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term lang='en'>"Keep transparency" setting</term>
    <listitem>
      <para lang='en'>
        In the upper right corner of the Layers dialog appears a small
        checkbox that controls the "keep transparency" setting for the
        layer.  If this is checked, then the alpha channel for the
        layer is locked,
        and no manipulation has any effect on it.  In particular,
        nothing that you do to a transparent part of the layer will
        have any effect.
      </para>
    </listitem>
    </varlistentry>

  </variablelist>

  <simplesect>
    <title lang='en'>Creating New Layers</title>
    
    <para lang='en'>
      There are several ways to create new layers in an image.  Here
      are the most important ones:
    </para>

    <itemizedlist>

      <listitem>
        <para lang='en'>
          Selecting
          <menuchoice>
            <guimenu>Layer</guimenu>
            <guimenuitem>New Layer</guimenuitem>
          </menuchoice>
          in the image menu.  This brings up a dialog that allows you
          to set the basic properties of the new layer; see the <link
          linkend='gimp-dialogs-new-layer'>New Layer dialog</link>
          section for help with it.
        </para>
      </listitem>

      <listitem>
        <para lang='en'>
          Selecting
          <menuchoice>
            <guimenu>Layer</guimenu>
            <guimenuitem>Duplicate Layer</guimenuitem>
          </menuchoice>
          in the image menu.  This creates a new layer, at the top of
          the layer stack, that is a perfect copy of the currently
          active layer.
        </para>
      </listitem>

      <listitem>
        <para lang='en'>
          When you "cut" something, and then paste it using Ctrl-V or 
          <menuchoice>
            <guimenu>Edit</guimenu>
            <guimenuitem>Paste</guimenuitem>
          </menuchoice>, the result is a
            "floating selection", which is a sort of temporary layer.
            Before you can do anything else, you either have to anchor
            the floating selection to an existing layer, or convert it
            into a normal layer.  If you do the latter, the new layer
            will be sized just large enough to contain the pasted
            material. 
        </para>
      </listitem>

    </itemizedlist>

  </simplesect>

</sect2>
