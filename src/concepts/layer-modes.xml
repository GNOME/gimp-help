<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
                       "http://www.docbook.org/xml/4.3/docbookx.dtd">
<!--Section History
  2009-02-21 j.h: revised for v2.6
  2008-04-06 Mr.Dust : reviewed and added 'ko'
  2008-01-05 jpl: added example to 'dissolve'
  2007-09-23 AntI: Added 'es'
  2007-07-14 bug fixed in Color Erase
  2007-04-29 Dust : added "ko"
  2007-02-15 ciampix: added "it"
  2007-02-13 KoSt: added 'no'
  2007-01-19 lexA: moved en over from the glossary
  2007-01-13 lexA: relocated from the layer dialog and added
                   examples and equations
  2006-09-06 scb: thorough review and/or rewrite of English
-->
<sect1 id="gimp-concepts-layer-modes">
  <title>Layer Modes</title>

  <indexterm>
    <primary>Layer</primary>
    <secondary>Modes</secondary>
  </indexterm>
  <indexterm>
    <primary>Modes of layers</primary>
  </indexterm>
  <indexterm>
    <primary>Color</primary>
    <secondary>Merging layer Modes</secondary>
  </indexterm>

  <para>
    <acronym>GIMP</acronym> has twenty-one layer modes. Layer modes are also
    sometimes called <quote>blending modes</quote>.
    Selecting a layer mode changes the appearance of the layer or image,
    based on the layer or layers beneath it. If there is only one layer, the
    layer mode has no effect. There must therefore be at least two layers in
    the image to be able to use layer modes.
  </para>
  <para>
    You can set the layer mode in the <guilabel>Mode</guilabel>
    menu in the Layers dialog. <acronym>GIMP</acronym>
    uses the layer mode to determine how to combine each pixel in the top
    layer with the pixel in the same location in the layer below it.
  </para>
  <note>
    <para>
      There is a drop-down list in the Toolbox options box which contains
      modes that affect the painting tools in a similar way to the layer
      modes. You can use all of the same modes for painting that are available
      for layers, and there are two additional modes just for the painting
      tools. See <xref linkend="gimp-tools-brush"/>.
    </para>
  </note>
  <para>
    Layer modes permit complex color changes in the image. They are often used
    with a new layer which acts as a kind of mask. For example, if you put a
    solid white layer over an image and set the layer mode of the new layer to
    <quote>Saturation</quote>, the underlying visible layers will appear in
    shades of gray.
  </para>

  <figure>
    <title>Images (masks) for layer mode examples</title>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/using/layer-mode-mask1.jpg" format="JPG"/>
      </imageobject>
      <caption>
        <para>Mask 1</para>
      </caption>
    </mediaobject>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/using/layer-mode-mask2.jpg" format="JPG"/>
      </imageobject>
      <caption>
        <para>Mask 2</para>
      </caption>
    </mediaobject>
  </figure>

  <figure>
    <title>Images (backgrounds) for layer mode examples</title>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/using/keyfob_orig.png" format="PNG"/>
      </imageobject>
      <caption>
        <para>Key fob</para>
      </caption>
    </mediaobject>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/using/duck_orig.png" format="PNG"/>
      </imageobject>
      <caption>
        <para>Ducks</para>
      </caption>
    </mediaobject>
  </figure>

  <para>
    In the descriptions of the layer modes below, the equations are also
    shown. This is for those who are curious about the mathematics of the
    layer modes. You do not need to understand the equations in order to use
    the layer modes effectively, however.
  </para>
  <para>
    The equations are in a shorthand notation. For example, the equation
  </para>
  <equation>
    <title>Example</title>
    <alt role="latex">$$E = M + I$$</alt>
    <graphic fileref="images/math/layer-mode-example.png" format="PNG"/>
  </equation>
  <para>
    means,
    <quote>
      For each pixel in the upper (<emphasis>M</emphasis>ask)and lower
      (<emphasis>I</emphasis>mage) layer, add each of the
      corresponding color components together to form the
      <emphasis>E</emphasis> resulting pixel's color.
    </quote>
    Pixel color components must always be between 0 and 255.
  </para>
  <note>
    <!-- cf. bug #544965 (2008-07-27) -->
    <para>
      Unless the description below says otherwise, a negative color component
      is set to 0 and a color component larger than 255 is set to 255.
    </para>
  </note>
  <para>
    The examples below show the effects of each of the modes.
  </para>
  <para>
    Since the results of each mode vary greatly depending upon the colors on
    the layers, these images can only give you a general idea of how the modes
    work. You are encouraged to try them out yourself. You might start with
    two similar layers, where one is a copy of the other, but slightly
    modified (by being blurred, moved, rotated, scaled, color-inverted, etc.)
    and seeing what happens with the layer modes.
  </para>

  <variablelist>
    <varlistentry>
      <term>Normal</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Normal</secondary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Normal</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-normal-50.jpg"/>
            </imageobject>
            <caption>
              <para>
                Both images are blended into each other with the same
                intensity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-normal-100.jpg"/>
            </imageobject>
            <caption>
              <para>
                With 100% opacity only the upper layer is shown when blending
                with <quote>Normal</quote>.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Normal</guilabel>
          mode is the default layer mode. The layer on top covers the layers
          below it. If you want to see anything below the top layer when you
          use this mode, the layer must have some transparent areas.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Normal</quote></title>
          <alt role="latex">$$E = M$$</alt>
          <graphic fileref="images/math/layer-mode-normal.png" format="PNG"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Dissolve</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Dissolve</secondary>
        </indexterm>
        <indexterm>
          <primary>Dissolve</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Dissolve</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-dissolve-50.jpg"/>
            </imageobject>
            <caption>
              <para>
                Both images are blended into each other with the same
                intensity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-dissolve-100.jpg"/>
            </imageobject>
            <caption>
              <para>
                With 100% opacity only the upper layer is shown when blending
                with <quote>dissolve</quote>.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Dissolve</guilabel>
          mode dissolves the upper layer into the layer beneath it by drawing
          a random pattern of pixels in areas of partial transparency. It is
          useful as a layer mode, but it is also often useful as a painting
          mode.
        </para>
        <para>
          This is especially visible along the edges within an image. It is
          easiest to see in an enlarged screenshot. The image on the left
          illustrates <quote>Normal</quote> layer mode (enlarged) and the
          image on the right shows the same two layers in
          <quote>Dissolve</quote>
          mode, where it can be clearly seen how the pixels are dispersed.
        </para>
        <figure>
          <title>Enlarged screenshots</title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-dissolve-nbig.jpg"/>
            </imageobject>
            <caption>
              <para>Normal mode.</para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-dissolve-dbig.jpg"/>
            </imageobject>
            <caption>
              <para>Dissolve mode.</para>
            </caption>
          </mediaobject>
        </figure>
      </listitem>
    </varlistentry>

    <varlistentry id="layer-mode-multiply">
      <term>Multiply</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Multiply</secondary>
        </indexterm>
        <indexterm>
          <primary>Multiply</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Multiply</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-multiply-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-multiply-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Multiply</guilabel>
          mode multiplies the pixel values of the upper layer with those of
          the layer below it and then divides the result by 255. The result is
          usually a darker image. If either layer is white, the resulting
          image is the same as the other layer (1 * I = I). If either layer
          is black, the resulting image is completely black (0 * I = 0).
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Multiply</quote></title>
          <alt role="latex">$$E = \frac{M \times I}{255}$$</alt>
          <graphic fileref="images/math/layer-mode-multiply.png" format="PNG"/>
        </equation>
        <para>
          The mode is commutative; the order of the two layers doesn't matter.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Divide</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Divide</secondary>
        </indexterm>
        <indexterm>
          <primary>Divide</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Divide</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-divide-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-divide-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Divide</guilabel>
          mode multiplies each pixel value in the lower layer by 256 and then
          divides that by the corresponding pixel value of the upper layer
          plus one. (Adding one to the denominator avoids dividing by zero.)
          The resulting image is often lighter, and sometimes looks
          <quote>burned out</quote>.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Divide</quote></title>
          <alt role="latex">$$E = \frac{256 \times I}{M + 1}$$</alt>
          <graphic fileref="images/math/layer-mode-divide.png" format="JPG"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Screen</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Screen</secondary>
        </indexterm>
        <indexterm>
          <primary>Screen</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Screen</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-screen-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-screen-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Screen</guilabel>
          mode inverts the values of each of the visible pixels in the two
          layers of the image. (That is, it subtracts each of them from 255.)
          Then it multiplies them together, divides by 255 and inverts
          this value again. The resulting image is usually brighter, and
          sometimes <quote>washed out</quote>
          in appearance. The exceptions to this are a black layer, which does
          not change the other layer, and a white layer, which results in a
          white image. Darker colors in the image appear to be more
          transparent.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Screen</quote></title>
          <alt role="latex">
            $$E = 255 - \frac{(255-M)\times (255-I)}{255}$$
          </alt>
          <graphic fileref="images/math/layer-mode-screen.png"/>
        </equation>
        <para>
          The mode is commutative; the order of the two layers doesn't matter.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry id="layer-mode-overlay">
      <term>Overlay</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Overlay</secondary>
        </indexterm>
        <indexterm>
          <primary>Overlay</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Overlay</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-overlay-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-overlay-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Overlay</guilabel>
          mode inverts the pixel value of the lower layer, multiplies it by
          two times the pixel value of the upper layer, adds that to the
          original pixel value of the lower layer, divides by 255, and then
          multiplies by the pixel value of the original lower layer and
          divides by 255 again. It darkens the image, but not as much as with
          <quote>Multiply</quote> mode.
        </para>
        <para>
          The equation is:
          <footnote id="gimp-layer-mode-bug162395">
            <para>
              The equation is the *theoretical* equation. Due to
              <ulink url="http://bugzilla.gnome.org/show_bug.cgi?id=162395"> Bug
              #162395 </ulink>, the actual equation is equivalent to Soft
              light. It is difficult to fix this bug without changing the
              appearance of existing images.
            </para>
          </footnote>
        </para>
        <equation>
          <title>Equation for layer mode <quote>Overlay</quote></title>
          <alt role="latex">
            $$E = \frac{I}{255} \times
              \left(I + \frac{2\times M}{255} \times (255 - I)\right)$$
          </alt>
          <graphic fileref="images/math/layer-mode-overlay.png"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Dodge</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Dodge</secondary>
        </indexterm>
        <indexterm>
          <primary>Dodge</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Dodge</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-dodge-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-dodge-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Dodge</guilabel>
          mode multiplies the pixel value of the lower layer by 256, then
          divides that by the inverse of the pixel value of the top layer. The
          resulting image is usually lighter, but some colors may be inverted.
        </para>
        <para>
          In photography, dodging is a technique used in a darkroom to
          decrease the exposure in particular areas of the image. This brings
          out details in the shadows. When used for this purpose, dodge may
          work best on Grayscale images and with a painting tool, rather than
          as a layer mode.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Dodge</quote></title>
          <alt role="latex">$$E = \frac{256\times I}{(255 - M) + 1}$$</alt>
          <graphic fileref="images/math/layer-mode-dodge.png"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Burn</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Burn</secondary>
        </indexterm>
        <indexterm>
          <primary>Burn</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Burn</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-burn-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-burn-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Burn</guilabel>
          mode inverts the pixel value of the lower layer, multiplies it by
          256, divides that by one plus the pixel value of the upper layer,
          then inverts the result. It tends to make the image darker, somewhat
          similar to <quote>Multiply</quote> mode.
        </para>
        <para>
          In photography, burning is a technique used in a darkroom to
          increase the exposure in particular areas of the image. This brings
          out details in the highlights. When used for this purpose, burn may
          work best on Grayscale images and with a painting tool, rather than
          as a layer mode.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Burn</quote></title>
          <alt role="latex">$$E = 255 - \frac{256\times(255 - I)}{M + 1}$$</alt>
          <graphic fileref="images/math/layer-mode-burn.png"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Hard light</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Hard light</secondary>
        </indexterm>
        <indexterm>
          <primary>Hard light</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Hard light</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-hard-light-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-hard-light-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Hard light</guilabel>
          mode is rather complicated because the equation consists of two
          parts, one for darker colors and one for brighter colors. If the
          pixel color of the upper layer is greater than 128, the layers are
          combined according to the first formula shown below. Otherwise, the
          pixel values of the upper and lower layers are multiplied together
          and multiplied by two, then divided by 256. You might use this mode
          to combine two photographs and obtain bright colors and sharp edges.
        </para>
        <para>
          The equation is complex and different according to
          the value &gt;128 or &le; 128:</para>
        <equation>
          <title>
            Equation for layer mode <quote>Hard light</quote>, M &gt; 128
          </title>
          <alt role="latex">
            $$E = 255 - \frac{\big(255 - 2\times (M-128)\big)\times (255 - I)}
              {256}, \qquad M > 128$$
          </alt>
          <graphic fileref="images/math/layer-mode-hard-light1.png"/>
        </equation>
        <equation>
          <title>
            Equation for layer mode <quote>Hard light</quote>, M &le; 128
          </title>
          <alt role="latex">
            $$E = \frac{2 \times M \times I}{256}, \qquad M \le 128$$
          </alt>
          <graphic fileref="images/math/layer-mode-hard-light2.png"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Soft light</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Soft light</secondary>
        </indexterm>
        <indexterm>
          <primary>Soft light</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Soft light</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-soft-light-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-soft-light-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Soft light</guilabel> is not related to
          <quote>Hard light</quote> in anything but the name, but it
          does tend to make the edges softer and the colors not so
          bright. It is similar to <quote>Overlay</quote> mode. In some
          versions of <acronym>GIMP</acronym>, <quote>Overlay</quote>
          mode and <quote>Soft light</quote> mode are identical.
        </para>
        <para>The equation is complicated. It needs Rs, the
          result of Screen mode :
        </para>
        <equation>
          <title>Equation for layer mode <quote>Screen</quote></title>
          <alt role="latex">
              $$R_{s} = 255 - \frac{(255-M)\times(255-I)}{255}$$
            </alt>
          <graphic fileref="images/math/layer-mode-soft-light1.png"/>
        </equation>
        <equation>
          <title>Equation for layer mode <quote>Soft light</quote></title>
          <alt role="latex">
            $$E = \frac{(255-I)\times M + R_{s}}{255} \times I$$
          </alt>
          <graphic fileref="images/math/layer-mode-soft-light2.png"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Grain extract</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Grain extract</secondary>
        </indexterm>
        <indexterm>
          <primary>Grain extract</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Grain extract</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-grain-extract-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-grain-extract-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Grain extract</guilabel>
          mode is supposed to extract the <quote>film grain</quote>
          from a layer to produce a new layer that is pure grain, but it can
          also be useful for giving images an embossed appearance. It
          subtracts the pixel value of the upper layer from that of the lower
          layer and adds 128.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Grain extract</quote></title>
          <alt role="latex">$$E = I - M + 128$$</alt>
          <graphic fileref="images/math/layer-mode-grainextract.png"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Grain merge</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Grain merge</secondary>
        </indexterm>
        <indexterm>
          <primary>Grain merge</primary>
        </indexterm>
        <para>
          There are two more layer modes, but these are available only for
          painting tools. See
          <link linkend="gimp-tool-painting-modes">Painting Modes</link>
          for detailed information.
        </para>
        <figure>
          <title>Example for layer mode <quote>Grain merge</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-grain-merge-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-grain-merge-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Grain merge</guilabel> mode merges a grain layer
          (possibly one created from the <quote>Grain extract</quote>
          mode) into the current layer, leaving a grainy version of the
          original layer. It does just the opposite of
          <quote>Grain extract</quote>. It adds the pixel values of the
          upper and lower layers together and subtracts 128.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Grain merge</quote></title>
          <alt role="latex">$$E = I + M - 128$$</alt>
          <graphic fileref="images/math/layer-mode-grainmerge.png"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry id="layer-mode-difference">
      <term>Difference</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Difference</secondary>
        </indexterm>
        <indexterm>
          <primary>Difference</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Difference</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-difference-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-difference-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Difference</guilabel>
          mode subtracts the pixel value of the upper layer from that of the
          lower layer and then takes the absolute value of the result. No
          matter what the original two layers look like, the result looks
          rather odd. You can use it to invert elements of an image.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Difference</quote></title>
          <alt role="latex">$$E = |I - M|$$</alt>
          <graphic fileref="images/math/layer-mode-difference.png"/>
        </equation>
        <para>
          The mode is commutative; the order of the two layers doesn't matter.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Addition</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Addition</secondary>
        </indexterm>
        <indexterm>
          <primary>Addition</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Addition</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-addition-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-addition-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Addition</guilabel>
          mode is very simple. The pixel values of the upper and lower layers
          are added to each other. The resulting image is usually lighter. The
          equation can result in color values greater than 255, so some of the
          light colors may be set to the maximum value of 255.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Addition</quote></title>
          <alt role="latex">$$E = \min\bigl( (M + I), 255\bigr)$$</alt>
          <graphic fileref="images/math/layer-mode-addition.png"/>
        </equation>
        <para>
          The mode is commutative; the order of the two layers doesn't matter.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Subtract</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Subtract</secondary>
        </indexterm>
        <indexterm>
          <primary>Subtract</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Subtract</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-subtract-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-subtract-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Subtract</guilabel>
          mode subtracts the pixel values of the upper layer from the pixel
          values of the lower layer. The resulting image is normally darker.
          You might get a lot of black or near-black in the resulting image.
          The equation can result in negative color values, so some of the
          dark colors may be set to the minimum value of 0.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Subtraction</quote></title>
          <alt role="latex">$$E = \max\bigl( (I - M), 0\bigr)$$</alt>
          <graphic fileref="images/math/layer-mode-subtract.png"/>
        </equation>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Darken only</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Darken only</secondary>
        </indexterm>
        <indexterm>
          <primary>Darken only</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Darken only</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-darken-only-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-darken-only-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guimenuitem>Darken only</guimenuitem>
          mode compares each component of each pixel in the upper layer with
          the corresponding one in the lower layer and uses the smaller value
          in the resulting image. Completely white layers have no effect on
          the final image and completely black layers result in a black image.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Darken only</quote></title>
          <alt role="latex">$$E = \min(M, I)$$</alt>
          <graphic fileref="images/math/layer-mode-darken.png"/>
        </equation>
        <para>
          The mode is commutative; the order of the two layers doesn't matter.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Lighten only</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Lighten only</secondary>
        </indexterm>
        <indexterm>
          <primary>Lighten only</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Lighten only</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-lighten-only-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-lighten-only-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guimenuitem>Lighten only</guimenuitem>
          mode compares each component of each pixel in the upper layer with
          the corresponding one in the lower layer and uses the larger value
          in the resulting image. Completely black layers have no effect on
          the final image and completely white layers result in a white image.
        </para>
        <para>The equation is:</para>
        <equation>
          <title>Equation for layer mode <quote>Lighten only</quote></title>
          <alt role="latex">$$E = \max(M, I)$$</alt>
          <graphic fileref="images/math/layer-mode-lighten.png"/>
        </equation>
        <para>
          The mode is commutative; the order of the two layers doesn't matter.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Hue</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Hue</secondary>
        </indexterm>
        <indexterm>
          <primary>Hue</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Hue</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-hue-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-hue-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Hue</guilabel>
          mode uses the hue of the upper layer and the saturation and value of
          the lower layer to form the resulting image. However, if the
          saturation of the upper layer is zero, the hue is taken from the
          lower layer, too.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Saturation</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Saturation</secondary>
        </indexterm>
        <indexterm>
          <primary>Saturation</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Saturation</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-saturation-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-saturation-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Saturation</guilabel>
          mode uses the saturation of the upper layer and the hue and value of
          the lower layer to form the resulting image.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Color</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Color</secondary>
        </indexterm>
        <indexterm>
          <primary>Color</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Color</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-color-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-color-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Color</guilabel>
          mode uses the hue and saturation of the upper layer and the value of
          the lower layer to form the resulting image.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Value</term>
      <listitem>
        <indexterm>
          <primary>Layer Modes</primary>
          <secondary>Value</secondary>
        </indexterm>
        <indexterm>
          <primary>Value</primary>
        </indexterm>
        <figure>
          <title>Example for layer mode <quote>Value</quote></title>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-value-mask1.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 1 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
          <mediaobject>
            <imageobject>
              <imagedata format="JPG"
                fileref="images/using/layer-mode-value-mask2.jpg"/>
            </imageobject>
            <caption>
              <para>
                Mask 2 is used as upper layer with 100% opacity.
              </para>
            </caption>
          </mediaobject>
        </figure>
        <para>
          <guilabel>Value</guilabel>
          mode uses the value of the upper layer and the saturation and hue of
          the lower layer to form the resulting image. You can use this mode
          to reveal details in dark and light areas of an image without
          changing the saturation.
        </para>
      </listitem>
    </varlistentry>
  </variablelist>

  <para>
    Each layer in an image can have a different layer mode. (Of course, the
    layer mode of the bottom layer of an image has no effect.) The effects of
    these layer modes are cumulative. The image shown below has three layers.
    The top layer consists of Wilber surrounded by transparency and has a
    layer mode of <quote>Difference</quote>.
    The second layer is solid light blue and has a layer mode of
    <quote>Addition</quote>. The bottom layer is filled with the
    <quote>Red Cubes</quote> pattern.
  </para>
  <figure>
    <title>Multi layer example</title>
    <mediaobject>
      <imageobject>
        <imagedata format="PNG"
          fileref="images/glossary/modes-multilayer.png"/>
      </imageobject>
    </mediaobject>
  </figure>
  <para>
    <acronym>GIMP</acronym> also has similar modes which are used for the
    painting tools. These are the same twenty-one modes as the layer modes,
    plus additionally two modes which are specific to the painting tools. You
    can set these modes from the <guilabel>Mode</guilabel> menu in the Tools
    option dialog. In the equations shown above, the layer you are painting on
    is the <quote>lower layer</quote> and the pixels painted by the tool are
    the <quote>upper layer</quote>. Naturally, you do not need more than one
    layer in the image to use these modes, since they only operate on the
    current layer and the selected painting tool.
  </para>
  <para>
    See <xref linkend="gimp-paint-mode-examples"/> for a description of the
    two additional painting modes.
  </para>
</sect1>
